version: "3.8"
services:
   db:
      image: postgres:15
      environment:
         POSTGRES_USER: postgres
         POSTGRES_PASSWORD: postgres
         POSTGRES_DB: marketplace
      volumes:
         - postgres_data:/var/lib/postgresql/data

   redis:
      image: redis:7
      ports:
         - "6379:6379"

   server:
      build:
         context: ./server
      environment:
         - FLASK_ENV=production
         - DATABASE_URL=postgresql://postgres:postgres@db:5432/marketplace
         - REDIS_URL=redis://redis:6379/0
         - ADMIN_EMAIL=admin@example.com
         - ADMIN_PASSWORD=admin123
         - CLIENT_URL=http://localhost:3000
      depends_on:
         - db
         - redis
      ports:
         - "5000:5000"
      volumes:
         - ./uploads:/app/uploads

   client:
      build:
         context: ./client
      environment:
         - NEXT_PUBLIC_API_URL=http://localhost:5000
      ports:
         - "3000:3000"
      depends_on:
         - server

volumes:
   postgres_data:
